name: 安全检查
on:
  push:
    branches: [ master ]  # 根据实际分支调整

jobs:
  security-check:
    runs-on: ubuntu-latest
    steps:
      - name: 检出代码
        uses: actions/checkout@v4

      - name: 安装PNPM
        uses: pnpm/action-setup@v4
        with:
          version: 8

      - name: 设置Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'pnpm'

      - name: 安装依赖
        run: pnpm install

      - name: 检查敏感信息（示例）
        run: |
          # 检查是否意外提交了敏感文件（如.env、密钥等）
          if [ -f ".env" ]; then
            echo "⚠️ 警告：检测到.env文件，请检查是否包含敏感信息！"
            exit 1
          fi

      - name: 依赖漏洞扫描
        run: |
          # 使用PNPM的audit功能检查依赖漏洞
          pnpm audit || echo "⚠️ 发现依赖漏洞，建议运行 'pnpm audit --fix' 修复"
